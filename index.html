<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>æ°´æœè”¬èœåˆ†é¡å¤§å†’éšª</title>
    
    <!-- PWA è¨­å®š -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="æ°´æœè”¬èœåˆ†é¡">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iNDAiIGZpbGw9IiNGRjZEMDAiLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIj4KPHN2ZyB3aWR0aD0iOTYiIGhlaWdodD0iOTYiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSI+Cjx0ZXh0IHg9IjEyIiB5PSIxNiIgZm9udC1zaXplPSIxNiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiPvCfjY08L3RleHQ+Cjwvc3ZnPgo8L3N2Zz4KPC9zdmc+">
    
    <!-- Web App Manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIuawtOaenOiUlOiPnOWIhuexu+mBiumMryIsCiAgInNob3J0X25hbWUiOiAi5YiG6aGe6YGK5oivIiwKICAic3RhcnRfdXJsIjogIi4vIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjRkZGRkZGIiwKICAidGhlbWVfY29sb3IiOiAiI0ZGNkQwMCIsCiAgImljb25zIjogWwogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU1Ua3lJaUJvWldsbmFIUTlJakU1TWlJZ2RtbGxkMEp2ZUQwaU1DQXdJREU1TWlBeE9USWlJR1pwYkd3OUltNXZibVVpSUhodGJHNXpQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh5TURBd0wzTjJaeUkrQ2p4eVpXTjBJSGRwWkhSb1BTSXhPVElpSUdobGFXZG9kRDBpTVRreUlpQnllRDBpTkRBaUlHWnBiR3c5SWlOR1JqWkVNREFpTHo0S1BITjJaeUI0UFNJME9DSWdlVDBpTkRnaUlIZHBaSFJvUFNJNU5pSWdhR1ZwWjJoMFBTSTVOaUlnZG1sbGQwSnZlRDBpTUNBd0lESTBJREkwSWlCbWFXeHNQU0p1YjI1bElqNEtQSE4yWnlCM2FXUjBhRDBpT1RZaUlHaGxhV2RvZEQwaU9UWWlJSFpwWlhkQ2IzZzlJakFnTUNBeU5DQXlOQ0lnWm1sc2JEMGlibTl1WlNJK0NqeDBaWGgwSUhnOUlqRXlJaUI1UFNJeE5pSWdabTl1ZEMxemFYcGxQU0l4TmlJZ2RHVjRkQzFoYm1Ob2IzSTlJbTFwWkdSc1pTSWdabWxzYkQwaWQyaHBkR1VpUGZ3bmFZMk5QQzkwWlhoMFBnbzhMM04yWno0S1BDOXpkbWMrQ2p3dmMzWm5QZ289IiwKICAgICAgInNpemVzIjogIjE5MngxOTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfQogIF0KfQ==">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        
        .drag-item {
            transition: transform 0.2s ease;
            cursor: grab;
            touch-action: none;
            user-select: none;
        }
        
        .drag-item:hover, .drag-item:active {
            transform: scale(1.1);
        }
        
        .drag-item.dragging {
            transform: rotate(5deg) scale(1.1);
            z-index: 1000;
            opacity: 0.8;
        }
        
        /* æ‰‹æ©Ÿè§¸æ§å„ªåŒ– */
        @media (max-width: 768px) {
            .drag-item {
                padding: 16px !important;
                font-size: 1.2rem;
            }
            
            .drop-zone {
                min-height: 120px;
            }
        }
        
        .drop-zone {
            transition: all 0.3s ease;
        }
        
        .drop-zone.drag-over {
            background-color: #fef3c7;
            border-color: #f59e0b;
            transform: scale(1.02);
        }
        
        .correct-drop {
            animation: bounce 0.6s ease;
        }
        
        .wrong-drop {
            animation: shake 0.5s ease;
        }
        
        @keyframes bounce {
            0%, 20%, 60%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            80% { transform: translateY(-5px); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .level-complete {
            animation: levelUp 1s ease;
        }
        
        @keyframes levelUp {
            0% { transform: scale(1); }
            50% { transform: scale(1.2) rotate(5deg); }
            100% { transform: scale(1); }
        }
        
        .star {
            animation: twinkle 1s ease infinite alternate;
        }
        
        @keyframes twinkle {
            0% { opacity: 0.5; transform: scale(1); }
            100% { opacity: 1; transform: scale(1.2); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-200 via-purple-200 to-pink-200 min-h-screen">
    <div class="container mx-auto px-4 py-6">
        <!-- æ¨™é¡Œå’Œé—œå¡è³‡è¨Š -->
        <div class="text-center mb-6">
            <h1 class="text-4xl font-bold text-purple-800 mb-2">ğŸ æ°´æœè”¬èœåˆ†é¡å¤§å†’éšª ğŸ¥•</h1>
            <div class="flex justify-center items-center gap-4 mb-4">
                <div class="bg-white rounded-full px-4 py-2 shadow-lg">
                    <span class="text-lg font-bold text-blue-600">é—œå¡ <span id="current-level">1</span></span>
                </div>
                <div class="bg-white rounded-full px-4 py-2 shadow-lg">
                    <span class="text-lg font-bold text-green-600">å¾—åˆ†: <span id="score">0</span></span>
                </div>
                <div class="bg-white rounded-full px-4 py-2 shadow-lg">
                    <span class="text-lg font-bold text-orange-600">å®Œæˆ: <span id="completed">0</span>/<span id="total">6</span></span>
                </div>
            </div>
            <div id="level-description" class="text-lg text-purple-600 font-semibold"></div>
        </div>

        <!-- é—œå¡é€²åº¦æ¢ -->
        <div class="mb-6">
            <div class="bg-white rounded-full p-2 shadow-lg">
                <div class="bg-gray-200 rounded-full h-4 relative overflow-hidden">
                    <div id="progress-bar" class="bg-gradient-to-r from-green-400 to-blue-500 h-full rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- éŠæˆ²å€åŸŸ -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- å¾…åˆ†é¡ç‰©å“ -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-2xl p-6 shadow-xl">
                    <h2 class="text-2xl font-bold text-center text-gray-800 mb-4">ğŸ›’ å¾…åˆ†é¡</h2>
                    <div id="items-container" class="grid grid-cols-2 gap-3">
                        <!-- ç‰©å“æœƒå‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>
            </div>

            <!-- åˆ†é¡ç±ƒå­ -->
            <div class="lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- æ°´æœç±ƒ -->
                <div class="drop-zone bg-gradient-to-br from-red-100 to-orange-100 rounded-2xl p-6 border-4 border-dashed border-red-300 shadow-xl" 
                     data-category="fruit">
                    <div class="text-center mb-4">
                        <h2 class="text-2xl font-bold text-red-600">ğŸ æ°´æœç±ƒ</h2>
                        <p class="text-sm text-red-500">æŠŠæ°´æœæ‹–åˆ°é€™è£¡</p>
                    </div>
                    <div id="fruit-basket" class="grid grid-cols-4 gap-2 min-h-24">
                        <!-- å·²åˆ†é¡çš„æ°´æœæœƒå‡ºç¾åœ¨é€™è£¡ -->
                    </div>
                </div>

                <!-- è”¬èœç±ƒ -->
                <div class="drop-zone bg-gradient-to-br from-green-100 to-lime-100 rounded-2xl p-6 border-4 border-dashed border-green-300 shadow-xl" 
                     data-category="vegetable">
                    <div class="text-center mb-4">
                        <h2 class="text-2xl font-bold text-green-600">ğŸ¥• è”¬èœç±ƒ</h2>
                        <p class="text-sm text-green-500">æŠŠè”¬èœæ‹–åˆ°é€™è£¡</p>
                    </div>
                    <div id="vegetable-basket" class="grid grid-cols-4 gap-2 min-h-24">
                        <!-- å·²åˆ†é¡çš„è”¬èœæœƒå‡ºç¾åœ¨é€™è£¡ -->
                    </div>
                </div>
            </div>
        </div>

        <!-- æ§åˆ¶æŒ‰éˆ• -->
        <div class="text-center mt-6 space-x-4">
            <button id="hint-btn" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-6 rounded-full shadow-lg transform hover:scale-105 transition-all">
                ğŸ’¡ æç¤º
            </button>
            <button id="restart-level-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-full shadow-lg transform hover:scale-105 transition-all">
                ğŸ”„ é‡æ–°é–‹å§‹é—œå¡
            </button>
        </div>

        <!-- é—œå¡å®Œæˆç•«é¢ -->
        <div id="level-complete" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
            <div class="bg-white rounded-3xl p-8 text-center shadow-2xl max-w-md">
                <div class="text-6xl mb-4">ğŸ‰</div>
                <h2 class="text-3xl font-bold text-purple-600 mb-2">é—œå¡å®Œæˆï¼</h2>
                <div id="stars-display" class="flex justify-center mb-4">
                    <!-- æ˜Ÿæ˜Ÿæœƒå‹•æ…‹ç”Ÿæˆ -->
                </div>
                <p id="level-complete-message" class="text-lg text-gray-600 mb-6"></p>
                <div class="space-x-4">
                    <button id="next-level-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full">
                        ä¸‹ä¸€é—œ â¡ï¸
                    </button>
                    <button id="replay-level-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-full">
                        é‡ç©æœ¬é—œ
                    </button>
                </div>
            </div>
        </div>

        <!-- éŠæˆ²å®Œæˆç•«é¢ -->
        <div id="game-complete" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
            <div class="bg-white rounded-3xl p-8 text-center shadow-2xl max-w-md">
                <div class="text-6xl mb-4">ğŸ‘‘</div>
                <h2 class="text-3xl font-bold text-gold-600 mb-4">æ­å–œé€šé—œï¼</h2>
                <p class="text-lg text-gray-600 mb-6">ä½ å·²ç¶“æˆç‚ºæ°´æœè”¬èœåˆ†é¡å¤§å¸«äº†ï¼</p>
                <button id="restart-game-btn" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-6 rounded-full">
                    é‡æ–°æŒ‘æˆ°
                </button>
            </div>
        </div>
    </div>

    <script>
        // é—œå¡è¨­è¨ˆ - å¾ç°¡å–®åˆ°å›°é›£
        const levels = [
            {
                level: 1,
                name: "æ–°æ‰‹æ‘",
                description: "èªè­˜åŸºæœ¬çš„æ°´æœå’Œè”¬èœ",
                items: [
                    { id: 1, name: 'è˜‹æœ', emoji: 'ğŸ', category: 'fruit' },
                    { id: 2, name: 'é¦™è•‰', emoji: 'ğŸŒ', category: 'fruit' },
                    { id: 3, name: 'æ©˜å­', emoji: 'ğŸŠ', category: 'fruit' },
                    { id: 7, name: 'ç´…è˜¿è””', emoji: 'ğŸ¥•', category: 'vegetable' },
                    { id: 8, name: 'é’æ¤’', emoji: 'ğŸ«‘', category: 'vegetable' },
                    { id: 9, name: 'ç•ªèŒ„', emoji: 'ğŸ…', category: 'vegetable' }
                ]
            },
            {
                level: 2,
                name: "é€²éšæŒ‘æˆ°",
                description: "æ›´å¤šç¨®é¡çš„æ°´æœè”¬èœ",
                items: [
                    { id: 4, name: 'è‰è“', emoji: 'ğŸ“', category: 'fruit' },
                    { id: 5, name: 'è‘¡è„', emoji: 'ğŸ‡', category: 'fruit' },
                    { id: 6, name: 'è¥¿ç“œ', emoji: 'ğŸ‰', category: 'fruit' },
                    { id: 13, name: 'æ«»æ¡ƒ', emoji: 'ğŸ’', category: 'fruit' },
                    { id: 10, name: 'ç‰ç±³', emoji: 'ğŸŒ½', category: 'vegetable' },
                    { id: 11, name: 'èŒ„å­', emoji: 'ğŸ†', category: 'vegetable' },
                    { id: 12, name: 'èŠ±æ¤°èœ', emoji: 'ğŸ¥¦', category: 'vegetable' },
                    { id: 14, name: 'æ´‹è”¥', emoji: 'ğŸ§…', category: 'vegetable' }
                ]
            },
            {
                level: 3,
                name: "ç†±å¸¶æ°´æœ",
                description: "èªè­˜ç†±å¸¶å’Œç‰¹æ®Šæ°´æœ",
                items: [
                    { id: 15, name: 'é³³æ¢¨', emoji: 'ğŸ', category: 'fruit' },
                    { id: 16, name: 'èŠ’æœ', emoji: 'ğŸ¥­', category: 'fruit' },
                    { id: 17, name: 'æ¤°å­', emoji: 'ğŸ¥¥', category: 'fruit' },
                    { id: 18, name: 'å¥‡ç•°æœ', emoji: 'ğŸ¥', category: 'fruit' },
                    { id: 19, name: 'é…ªæ¢¨', emoji: 'ğŸ¥‘', category: 'fruit' },
                    { id: 20, name: 'é¦¬éˆ´è–¯', emoji: 'ğŸ¥”', category: 'vegetable' },
                    { id: 21, name: 'è˜‘è‡', emoji: 'ğŸ„', category: 'vegetable' },
                    { id: 22, name: 'å¤§è’œ', emoji: 'ğŸ§„', category: 'vegetable' },
                    { id: 23, name: 'å°é»ƒç“œ', emoji: 'ğŸ¥’', category: 'vegetable' },
                    { id: 24, name: 'èµè‹£', emoji: 'ğŸ¥¬', category: 'vegetable' }
                ]
            },
            {
                level: 4,
                name: "è±†é¡å°ˆå®¶",
                description: "å­¸ç¿’å„ç¨®è±†é¡å’Œæ ¹è–é¡",
                items: [
                    { id: 25, name: 'æª¸æª¬', emoji: 'ğŸ‹', category: 'fruit' },
                    { id: 26, name: 'æ¡ƒå­', emoji: 'ğŸ‘', category: 'fruit' },
                    { id: 27, name: 'æ¢¨å­', emoji: 'ğŸ', category: 'fruit' },
                    { id: 28, name: 'è—è“', emoji: 'ğŸ«', category: 'fruit' },
                    { id: 29, name: 'è±Œè±†', emoji: 'ğŸŸ¢', category: 'vegetable' },
                    { id: 30, name: 'è˜¿è””', emoji: 'ğŸ¥•', category: 'vegetable' },
                    { id: 31, name: 'èŠ¹èœ', emoji: 'ğŸ¥¬', category: 'vegetable' },
                    { id: 32, name: 'è èœ', emoji: 'ğŸ¥¬', category: 'vegetable' },
                    { id: 33, name: 'éŸ­èœ', emoji: 'ğŸ¥¬', category: 'vegetable' },
                    { id: 34, name: 'ç™½èœ', emoji: 'ğŸ¥¬', category: 'vegetable' },
                    { id: 35, name: 'é«˜éº—èœ', emoji: 'ğŸ¥¬', category: 'vegetable' },
                    { id: 36, name: 'å—ç“œ', emoji: 'ğŸƒ', category: 'vegetable' }
                ]
            },
            {
                level: 5,
                name: "çµ‚æ¥µæŒ‘æˆ°",
                description: "æœ€å›°é›£çš„åˆ†é¡æŒ‘æˆ°ï¼",
                items: [
                    { id: 37, name: 'æŸ¿å­', emoji: 'ğŸ…', category: 'fruit' },
                    { id: 38, name: 'çŸ³æ¦´', emoji: 'ğŸ', category: 'fruit' },
                    { id: 39, name: 'ç„¡èŠ±æœ', emoji: 'ğŸ‡', category: 'fruit' },
                    { id: 40, name: 'é¾çœ¼', emoji: 'ğŸ‡', category: 'fruit' },
                    { id: 41, name: 'è”æ', emoji: 'ğŸ‡', category: 'fruit' },
                    { id: 42, name: 'æ¥Šæ¡ƒ', emoji: 'â­', category: 'fruit' },
                    { id: 43, name: 'è“®è—•', emoji: 'âšª', category: 'vegetable' },
                    { id: 44, name: 'ç«¹ç­', emoji: 'ğŸ‹', category: 'vegetable' },
                    { id: 45, name: 'è‹¦ç“œ', emoji: 'ğŸ¥’', category: 'vegetable' },
                    { id: 46, name: 'çµ²ç“œ', emoji: 'ğŸ¥’', category: 'vegetable' },
                    { id: 47, name: 'å†¬ç“œ', emoji: 'ğŸ¥’', category: 'vegetable' },
                    { id: 48, name: 'ç§‹è‘µ', emoji: 'ğŸŒ¶ï¸', category: 'vegetable' },
                    { id: 49, name: 'å±±è—¥', emoji: 'ğŸ¥”', category: 'vegetable' },
                    { id: 50, name: 'åœ°ç“œ', emoji: 'ğŸ ', category: 'vegetable' }
                ]
            }
        ];

        // éŠæˆ²ç‹€æ…‹
        let currentLevel = 1;
        let score = 0;
        let completed = 0;
        let totalItems = 0;
        let draggedItem = null;
        let mistakes = 0;

        // åˆå§‹åŒ–éŠæˆ²
        function initGame() {
            currentLevel = 1;
            score = 0;
            startLevel(currentLevel);
        }

        // é–‹å§‹é—œå¡
        function startLevel(levelNum) {
            const level = levels[levelNum - 1];
            if (!level) {
                showGameComplete();
                return;
            }

            completed = 0;
            mistakes = 0;
            totalItems = level.items.length;
            
            // æ›´æ–°UI
            document.getElementById('current-level').textContent = levelNum;
            document.getElementById('level-description').textContent = `${level.name}: ${level.description}`;
            document.getElementById('total').textContent = totalItems;
            updateScore();
            updateProgress();
            
            // æ¸…ç©ºç±ƒå­
            document.getElementById('fruit-basket').innerHTML = '';
            document.getElementById('vegetable-basket').innerHTML = '';
            
            // æ‰“äº‚ç‰©å“é †åº
            const shuffledItems = [...level.items].sort(() => Math.random() - 0.5);
            
            // ç”Ÿæˆç‰©å“
            const container = document.getElementById('items-container');
            container.innerHTML = '';
            
            shuffledItems.forEach(item => {
                const itemElement = createItemElement(item);
                container.appendChild(itemElement);
            });
        }

        // å‰µå»ºç‰©å“å…ƒç´ 
        function createItemElement(item) {
            const div = document.createElement('div');
            div.className = 'drag-item bg-white rounded-xl p-3 shadow-lg border-2 border-gray-200 text-center hover:shadow-xl';
            div.draggable = true;
            div.dataset.id = item.id;
            div.dataset.category = item.category;
            
            div.innerHTML = `
                <div class="text-3xl mb-1">${item.emoji}</div>
                <div class="text-xs font-semibold text-gray-700">${item.name}</div>
            `;
            
            // æ¡Œé¢æ‹–æ‹½äº‹ä»¶
            div.addEventListener('dragstart', handleDragStart);
            div.addEventListener('dragend', handleDragEnd);
            
            // æ‰‹æ©Ÿè§¸æ§äº‹ä»¶
            div.addEventListener('touchstart', handleTouchStart, { passive: false });
            div.addEventListener('touchmove', handleTouchMove, { passive: false });
            div.addEventListener('touchend', handleTouchEnd, { passive: false });
            
            return div;
        }

        // è§¸æ§æ‹–æ‹½è®Šæ•¸
        let touchItem = null;
        let touchOffset = { x: 0, y: 0 };
        let ghostElement = null;

        // è§¸æ§é–‹å§‹
        function handleTouchStart(e) {
            e.preventDefault();
            touchItem = this;
            
            const touch = e.touches[0];
            const rect = this.getBoundingClientRect();
            touchOffset.x = touch.clientX - rect.left;
            touchOffset.y = touch.clientY - rect.top;
            
            // å‰µå»ºæ‹–æ‹½å¹½éˆå…ƒç´ 
            ghostElement = this.cloneNode(true);
            ghostElement.style.position = 'fixed';
            ghostElement.style.pointerEvents = 'none';
            ghostElement.style.zIndex = '1000';
            ghostElement.style.opacity = '0.8';
            ghostElement.style.transform = 'rotate(5deg) scale(1.1)';
            document.body.appendChild(ghostElement);
            
            this.classList.add('dragging');
            updateGhostPosition(touch.clientX, touch.clientY);
        }

        // è§¸æ§ç§»å‹•
        function handleTouchMove(e) {
            if (!touchItem) return;
            e.preventDefault();
            
            const touch = e.touches[0];
            updateGhostPosition(touch.clientX, touch.clientY);
            
            // æª¢æŸ¥æ˜¯å¦åœ¨æ”¾ç½®å€åŸŸä¸Šæ–¹
            const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
            const dropZone = elementBelow?.closest('.drop-zone');
            
            // ç§»é™¤æ‰€æœ‰æ‹–æ‹½æ‡¸åœæ•ˆæœ
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.remove('drag-over');
            });
            
            // æ·»åŠ ç•¶å‰æ‡¸åœæ•ˆæœ
            if (dropZone) {
                dropZone.classList.add('drag-over');
            }
        }

        // è§¸æ§çµæŸ
        function handleTouchEnd(e) {
            if (!touchItem) return;
            e.preventDefault();
            
            const touch = e.changedTouches[0];
            const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
            const dropZone = elementBelow?.closest('.drop-zone');
            
            // æ¸…ç†
            if (ghostElement) {
                document.body.removeChild(ghostElement);
                ghostElement = null;
            }
            
            touchItem.classList.remove('dragging');
            
            // ç§»é™¤æ‰€æœ‰æ‹–æ‹½æ‡¸åœæ•ˆæœ
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.remove('drag-over');
            });
            
            // è™•ç†æ”¾ç½®
            if (dropZone) {
                const dropCategory = dropZone.dataset.category;
                const itemCategory = touchItem.dataset.category;
                
                if (dropCategory === itemCategory) {
                    handleCorrectDrop(touchItem, dropZone);
                } else {
                    handleWrongDrop(touchItem);
                }
            }
            
            touchItem = null;
        }

        // æ›´æ–°å¹½éˆå…ƒç´ ä½ç½®
        function updateGhostPosition(x, y) {
            if (ghostElement) {
                ghostElement.style.left = (x - touchOffset.x) + 'px';
                ghostElement.style.top = (y - touchOffset.y) + 'px';
            }
        }

        // æ‹–æ‹½é–‹å§‹
        function handleDragStart(e) {
            draggedItem = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        // æ‹–æ‹½çµæŸ
        function handleDragEnd(e) {
            this.classList.remove('dragging');
            draggedItem = null;
        }

        // è¨­ç½®æ”¾ç½®å€åŸŸäº‹ä»¶
        document.querySelectorAll('.drop-zone').forEach(zone => {
            zone.addEventListener('dragover', handleDragOver);
            zone.addEventListener('dragenter', handleDragEnter);
            zone.addEventListener('dragleave', handleDragLeave);
            zone.addEventListener('drop', handleDrop);
        });

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDragEnter(e) {
            e.preventDefault();
            this.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            this.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            this.classList.remove('drag-over');
            
            if (!draggedItem) return;
            
            const dropCategory = this.dataset.category;
            const itemCategory = draggedItem.dataset.category;
            
            if (dropCategory === itemCategory) {
                handleCorrectDrop(draggedItem, this);
            } else {
                handleWrongDrop(draggedItem);
            }
        }

        // æ­£ç¢ºåˆ†é¡è™•ç†
        function handleCorrectDrop(item, dropZone) {
            const basket = dropZone.querySelector('[id$="-basket"]');
            
            // å‰µå»ºå°ç‰ˆæœ¬çš„ç‰©å“
            const smallItem = item.cloneNode(true);
            smallItem.className = 'bg-white rounded-lg p-1 shadow-md text-center transform scale-75';
            smallItem.draggable = false;
            
            // æ·»åŠ åˆ°ç±ƒå­
            basket.appendChild(smallItem);
            
            // å¾åŸä½ç½®ç§»é™¤
            item.remove();
            
            // æ›´æ–°åˆ†æ•¸
            const baseScore = 10;
            const bonusScore = Math.max(0, 5 - mistakes); // éŒ¯èª¤è¶Šå°‘çå‹µè¶Šå¤š
            score += baseScore + bonusScore;
            completed += 1;
            
            updateScore();
            updateProgress();
            
            // å‹•ç•«æ•ˆæœ
            dropZone.classList.add('correct-drop');
            setTimeout(() => dropZone.classList.remove('correct-drop'), 600);
            
            // æª¢æŸ¥é—œå¡æ˜¯å¦å®Œæˆ
            if (completed === totalItems) {
                setTimeout(() => showLevelComplete(), 500);
            }
        }

        // éŒ¯èª¤åˆ†é¡è™•ç†
        function handleWrongDrop(item) {
            mistakes++;
            item.classList.add('wrong-drop');
            setTimeout(() => item.classList.remove('wrong-drop'), 500);
        }

        // æ›´æ–°åˆ†æ•¸
        function updateScore() {
            document.getElementById('score').textContent = score;
            document.getElementById('completed').textContent = completed;
        }

        // æ›´æ–°é€²åº¦æ¢
        function updateProgress() {
            const progress = (completed / totalItems) * 100;
            document.getElementById('progress-bar').style.width = progress + '%';
        }

        // é¡¯ç¤ºé—œå¡å®Œæˆ
        function showLevelComplete() {
            const stars = calculateStars();
            const message = getCompletionMessage(stars);
            
            document.getElementById('level-complete-message').textContent = message;
            
            // é¡¯ç¤ºæ˜Ÿæ˜Ÿ
            const starsContainer = document.getElementById('stars-display');
            starsContainer.innerHTML = '';
            for (let i = 0; i < 3; i++) {
                const star = document.createElement('span');
                star.className = i < stars ? 'text-4xl text-yellow-400 star' : 'text-4xl text-gray-300';
                star.textContent = 'â­';
                starsContainer.appendChild(star);
            }
            
            document.getElementById('level-complete').classList.remove('hidden');
        }

        // è¨ˆç®—æ˜Ÿæ˜Ÿæ•¸é‡
        function calculateStars() {
            if (mistakes === 0) return 3;
            if (mistakes <= 2) return 2;
            return 1;
        }

        // ç²å–å®Œæˆè¨Šæ¯
        function getCompletionMessage(stars) {
            const messages = [
                "ç¹¼çºŒåŠªåŠ›ï¼",
                "åšå¾—ä¸éŒ¯ï¼",
                "å¤ªæ£’äº†ï¼å®Œç¾åˆ†é¡ï¼"
            ];
            return messages[stars - 1];
        }

        // é¡¯ç¤ºéŠæˆ²å®Œæˆ
        function showGameComplete() {
            document.getElementById('game-complete').classList.remove('hidden');
        }

        // æç¤ºåŠŸèƒ½
        function showHint() {
            const items = document.querySelectorAll('.drag-item');
            if (items.length === 0) return;
            
            const randomItem = items[Math.floor(Math.random() * items.length)];
            const category = randomItem.dataset.category;
            const categoryName = category === 'fruit' ? 'æ°´æœ' : 'è”¬èœ';
            
            randomItem.style.border = '3px solid #f59e0b';
            randomItem.style.boxShadow = '0 0 20px #f59e0b';
            
            alert(`æç¤ºï¼š${randomItem.querySelector('.text-xs').textContent} æ˜¯ ${categoryName}ï¼`);
            
            setTimeout(() => {
                randomItem.style.border = '2px solid #e5e7eb';
                randomItem.style.boxShadow = '';
            }, 3000);
        }

        // äº‹ä»¶ç›£è½å™¨
        document.getElementById('hint-btn').addEventListener('click', showHint);
        document.getElementById('restart-level-btn').addEventListener('click', () => startLevel(currentLevel));
        document.getElementById('next-level-btn').addEventListener('click', () => {
            document.getElementById('level-complete').classList.add('hidden');
            currentLevel++;
            startLevel(currentLevel);
        });
        document.getElementById('replay-level-btn').addEventListener('click', () => {
            document.getElementById('level-complete').classList.add('hidden');
            startLevel(currentLevel);
        });
        document.getElementById('restart-game-btn').addEventListener('click', () => {
            document.getElementById('game-complete').classList.add('hidden');
            initGame();
        });

        // PWA å®‰è£æç¤º
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            showInstallPrompt();
        });

        function showInstallPrompt() {
            const installBanner = document.createElement('div');
            installBanner.id = 'install-banner';
            installBanner.className = 'fixed top-0 left-0 right-0 bg-orange-500 text-white p-3 text-center z-50';
            installBanner.innerHTML = `
                <div class="flex items-center justify-between max-w-md mx-auto">
                    <span class="text-sm">ğŸ“± å®‰è£åˆ°æ‰‹æ©Ÿæ¡Œé¢</span>
                    <div>
                        <button id="install-btn" class="bg-white text-orange-500 px-3 py-1 rounded text-sm font-bold mr-2">å®‰è£</button>
                        <button id="dismiss-btn" class="text-white text-sm">âœ•</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(installBanner);
            
            document.getElementById('install-btn').addEventListener('click', async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    deferredPrompt = null;
                    installBanner.remove();
                }
            });
            
            document.getElementById('dismiss-btn').addEventListener('click', () => {
                installBanner.remove();
            });
        }

        // Service Worker è¨»å†Š
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    const CACHE_NAME = 'fruit-veggie-game-v1';
                    const urlsToCache = [
                        './',
                        'https://cdn.tailwindcss.com'
                    ];

                    self.addEventListener('install', (event) => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then((cache) => cache.addAll(urlsToCache))
                        );
                    });

                    self.addEventListener('fetch', (event) => {
                        event.respondWith(
                            caches.match(event.request)
                                .then((response) => {
                                    return response || fetch(event.request);
                                })
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // åˆå§‹åŒ–éŠæˆ²
        initGame();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9728d5ce967f49fd',t:'MTc1NTc2NTcyNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
